/*!
 * Autocomplete module v.0.1.0
 * https://github.com/sfjs/sf-module-autocomplete/
 * Copyright (c) 2016, Alex Chepura, Yauheni Yasinau, Maxim Matveev, spiralscout.com
 */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("sf"));else if("function"==typeof define&&define.amd)define(["sf"],e);else{var s=e("object"==typeof exports?require("sf"):t.sf);for(var n in s)("object"==typeof exports?exports:t)[n]=s[n]}}(this,function(t){return function(t){function e(n){if(s[n])return s[n].exports;var i=s[n]={exports:{},id:n,loaded:!1};return t[n].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var s={};return e.m=t,e.c=s,e.p="",e(0)}([function(t,e,s){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}var i=s(2),o=n(i),r=s(3),a=n(r);s(27),o["default"].instancesController.registerInstanceType(a["default"],"js-sf-autocomplete"),t.exports=a["default"]},,function(e,s){e.exports=t},function(t,e,s){"use strict";function n(t){return t&&t.__esModule?t:{"default":t}}Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=void 0;var i=s(4),o=n(i),r=s(20),a=n(r),l=s(25),u=n(l),c=s(2),p=n(c),h=function(t,e,s){return t.split(".").reduce(function(t,e){return s?t?t[e]:void 0:t[e]})},d=function(t,e,s){this._construct(t,e,s)};d.prototype=(0,u["default"])(p["default"].core.BaseDOMConstructor.prototype),d.prototype.name="autocomplete",d.prototype._construct=function(t,e,s){this.init(t,e,s);var n={};this.options=(0,a["default"])(this.options,n),s&&(this.options=(0,a["default"])(this.options,s)),this.filled=!1,this.selectedIndex=-1,this.els={node:e,input:e,wrapper:t.helpers.domTools.closest(e,this.options.wrapperSelector),group:e.parentNode,hidden:document.createElement("input"),hints:null,addon:document.createElement("button")},this.els.input.autocomplete="off",this.els.wrapper.appendChild(this.els.hidden),this.els.hidden.setAttribute("type","hidden"),this.els.hidden.name=this.els.input.dataset.name,this.els.input.dataset.value&&(this.els.hidden.value=this.els.input.dataset.value),this.els.addon.className="btn-icon",this.els.addon.setAttribute("type","button"),this.els.group.appendChild(this.els.addon),"/"===this.options.url[this.options.url.length-1]&&(this.options.url=this.options.url.substring(0,this.options.url.length-1)),this.value=this.els.input.value,this.key=this.els.input.dataset.key,this.key&&this.value?this.setState("filled"):this.setState("search"),this.options.availableTags&&!this.options.url&&(this.options.deferRequestBy=0),this.addEventListeners()},d.prototype._key="",d.prototype.optionsToGrab={url:{value:"/",domAttr:"data-url"},allowNew:{value:!1,domAttr:"data-allow-new"},name:{value:"autocomplete",domAttr:"data-name"},wrapperSelector:{value:".item-form",domAttr:"data-wrapper-selector"},minChars:{value:1,domAttr:"data-min-chars"},query:{value:"query",domAttr:"data-query"},deferRequestBy:{value:500,domAttr:"data-defer"},suggestionsClassName:{value:"autocomplete-hint",domAttr:"data-suggestions-class"},selectedClassName:{value:"autocomplete-selected",domAttr:"data-selected-class"},onSelect:{domAttr:"data-on-select"}},d.prototype.optionsToProcess={availableTags:{processor:function(t){var e=t.getElementsByClassName("js-spiral-autocomplete-available-tags")[0];if(!e||!e.innerHTML)return this.value;var s;try{s=JSON.parse(e.innerHTML)}catch(n){console.error("Failed to parse JSON -",e.innerHTML,n),s=this.value}return s}}},d.prototype.addEventListeners=function(){function t(t){"keydown"===t.type&&s.onKeyPress(t),("input"===t.type||"change"===t.type)&&s.onInputChange(t),"click"===t.type&&s.wrap(t)}function e(n){s.options.availableTags&&s.onFocus(n),s.els.input.addEventListener("keydown",t),s.els.input.addEventListener("change",t),s.els.input.addEventListener("input",t),s.els.input.addEventListener("blur",function(){s.els.input.removeEventListener("keydown",t),s.els.input.removeEventListener("change",t),s.els.input.removeEventListener("input",t),s.els.input.removeEventListener("blur",e)},!1)}var s=this;this.els.input.addEventListener("focus",e),this.els.addon.addEventListener("click",function(){switch(s.state){case"search":s.onValueChange();break;case"filled":s.clear();break;case"add":s.addTag(!1,s.els.input.value);break;case"select":}})},d.prototype.keys={ESC:27,TAB:9,RETURN:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,BACKSPACE:8},d.prototype.getKeyByIndex=function(t){return this.els.hints.children[t].dataset.key},d.prototype.hide=function(){this.els.hints&&(this.els.group.removeChild(this.els.hints),this.els.hints=null,this.visible=!1,this.selectedIndex=-1,""!==this.value&&this.value!==this.els.input.value&&this.setState(this.options.allowNew?"add":"search"))},d.prototype.clear=function(){this.value="",this.els.input.value="",this.els.hidden.value="",this.suggestions={},this.filled=!1,this.hide(),this.setState("search")},d.prototype.trim=function(t){return t.trim().replace(/\s+/g,"_")},d.prototype.setState=function(t){this.state!==t&&(this.els.wrapper.classList.remove("item-state-"+this.state),this.els.wrapper.classList.add("item-state-"+t),this.state=t,"filled"===t?(this.hide(),this.els.input.readOnly=!0):this.els.input.readOnly=!1)},d.prototype.addTag=function(t,e){(this.options.allowNew||t!==!0)&&(this.els.hidden.value=this.options.allowNew?e:t,this.value=e,this.els.input.value=this.value,this.suggestions={},this.filled=!0,this.setState("filled"))},d.prototype.onInputChange=function(t){var e=this;this.disabled||(clearTimeout(this.onChangeTimeout),this.value!==this.els.input.value&&(this.findBestHint(),this.options.deferRequestBy>0?(this.options.allowNew&&this.setState("add"),this.onChangeTimeout=setTimeout(function(){e.onValueChange()},this.options.deferRequestBy)):this.onValueChange()))},d.prototype.findBestHint=function(){},d.prototype.onValueChange=function(t){this.value=this.els.input.value,this.options.availableTags&&!this.options.url?this.getSuggestions(this.value):(clearTimeout(this.onChangeTimeout),this.selectedIndex=-1,this.value.length<this.options.minChars?this.hide():this.getSuggestions(this.value))},d.prototype.getAvailableSuggestions=function(t){if(""!=t.trim()){var e={};for(var s in this.options.availableTags)this.options.availableTags.hasOwnProperty(s)&&-1!=this.options.availableTags[s].toLowerCase().indexOf(t.toLowerCase())&&(e[s]=this.options.availableTags[s]);this.suggest(e)}else this.suggest(this.options.availableTags)},d.prototype.getServerSuggestions=function(t){var e=this;if(""!=t.trim()){null!=this.ajax&&this.ajax[1].abort();var s={};s[e.options.query]=t,this.ajax=p["default"].ajax.send({url:e.options.url,data:s,isReturnXHRToo:!0}),this.ajax[0].then(function(t){e.value&&!e.filled&&e.suggest(t.suggestions)},function(t){}),this.setState("loading")}else this.hide()},d.prototype.getSuggestions=function(t){return this.options.disable?void this.setState("add"):void(this.options.availableTags&&!this.options.url?this.getAvailableSuggestions(t):this.getServerSuggestions(t))},d.prototype.prepareSuggestions=function(){var t=this,e=this.value,s="";if(this.suggestions&&(!Array.isArray(this.suggestions)&&(0,o["default"])(this.suggestions).length>0||Array.isArray(this.suggestions)&&this.suggestions.length>0))if(Array.isArray(this.suggestions))this.suggestions.forEach(function(n,i){s+='<div class="'+t.options.suggestionsClassName+'" data-key="'+i+'">'+t.formatResult(n,e)+"</div>"});else for(var n in this.suggestions)this.suggestions.hasOwnProperty(n)&&(s+='<div class="'+t.options.suggestionsClassName+'" data-key="'+n+'">'+t.formatResult(this.suggestions[n],e)+"</div>");else s='<div class="alert alert-info" style="text-align: center; margin: 0;">There are no suggestions for this query.</div>';return s},d.prototype.suggest=function(t){this.hide(),this.suggestions=t,this.els.hints=document.createElement("div"),this.els.hints.className="autocomplete-hints",this.els.hints.style.position="absolute",this.els.hints.innerHTML=this.prepareSuggestions(),this.els.group.insertBefore(this.els.hints,this.els.input.nextSibling),this.visible=!0,this.els.hints.addEventListener("click",this.onSuggestionsClick.bind(this)),this.setState(this.options.allowNew?"add":"select")},d.prototype.onSuggestionsClick=function(t){t.preventDefault();for(var e=t.target;!e.dataset.key&&e!==this.els.group;)e=e.parentNode;e.dataset.key&&this.select(e.dataset.key)},d.prototype.escapeRegExChars=function(t){return t.replace(/[\-\[\]\/\{}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},d.prototype.formatResult=function(t,e){var s="("+this.escapeRegExChars(e)+")";return t.replace(new RegExp(s,"gi"),"<strong>$1</strong>")},d.prototype.select=function(t){this.addTag(t,this.suggestions[t]),this.onSelect(t)},d.prototype.onSelect=function(){var t=window[h(this.options.onSelect,window)];t&&t.apply(this,arguments)},d.prototype.onFocus=function(){this.getSuggestions("")},d.prototype.onKeyPress=function(t){var e=this;if(!this.disabled&&!this.visible&&t.which===this.keys.DOWN&&this.value)return void this.onValueChange();switch(t.which){case e.keys.RETURN:t.stopImmediatePropagation(),t.preventDefault(),e.onKeyEnter();break;case e.keys.UP:if(!e.visible)return;e.onKeyUp();break;case e.keys.DOWN:if(!e.visible)return;e.onKeyDown();break;default:return}t.stopImmediatePropagation(),t.preventDefault()},d.prototype.onKeyEnter=function(){return-1===this.selectedIndex?void(this.options.allowNew||this.value!=this.els.input.value?this.addTag(!1,this.els.input.value):this.onValueChange()):void this.select(this.getKeyByIndex(this.selectedIndex))},d.prototype.onKeyUp=function(){this.moveUp()},d.prototype.onKeyDown=function(){this.moveDown()},d.prototype.moveUp=function(){var t=this;if(-1!==this.selectedIndex)return 0===this.selectedIndex?([].forEach.call(this.els.hints.children,function(e){e.classList.remove(t.options.selectedClassName)}),void(t.selectedIndex=-1)):void this.adjustScroll(this.selectedIndex-1)},d.prototype.moveDown=function(){this.selectedIndex!==this.els.hints.children.length-1&&this.adjustScroll(this.selectedIndex+1)},d.prototype.adjustScroll=function(t){this.highlight(t);var e=this.els.hints.children[this.selectedIndex],s=this.els.hints.clientHeight,n=e.offsetTop,i=e.offsetHeight;n<this.els.hints.scrollTop?this.els.hints.scrollTop=n:n>this.els.hints.scrollTop+s-i&&(this.els.hints.scrollTop=n-s+i)},d.prototype.highlight=function(t){var e=this;return[].forEach.call(this.els.hints.children,function(t){t.classList.remove(e.options.selectedClassName)}),this.els.hints.children[t].classList.add(e.options.selectedClassName),this.selectedIndex=t,null},d.prototype.die=function(){console.error("TODO DIE")},e["default"]=d},function(t,e,s){t.exports={"default":s(5),__esModule:!0}},function(t,e,s){var n=s(6);s(7),t.exports=function(t){return n.getNames(t)}},function(t,e){var s=Object;t.exports={create:s.create,getProto:s.getPrototypeOf,isEnum:{}.propertyIsEnumerable,getDesc:s.getOwnPropertyDescriptor,setDesc:s.defineProperty,setDescs:s.defineProperties,getKeys:s.keys,getNames:s.getOwnPropertyNames,getSymbols:s.getOwnPropertySymbols,each:[].forEach}},function(t,e,s){s(8)("getOwnPropertyNames",function(){return s(15).get})},function(t,e,s){var n=s(9),i=s(11),o=s(14);t.exports=function(t,e){var s=(i.Object||{})[t]||Object[t],r={};r[t]=e(s),n(n.S+n.F*o(function(){s(1)}),"Object",r)}},function(t,e,s){var n=s(10),i=s(11),o=s(12),r="prototype",a=function(t,e,s){var l,u,c,p=t&a.F,h=t&a.G,d=t&a.S,f=t&a.P,g=t&a.B,v=t&a.W,y=h?i:i[e]||(i[e]={}),m=h?n:d?n[e]:(n[e]||{})[r];h&&(s=e);for(l in s)u=!p&&m&&l in m,u&&l in y||(c=u?m[l]:s[l],y[l]=h&&"function"!=typeof m[l]?s[l]:g&&u?o(c,n):v&&m[l]==c?function(t){var e=function(e){return this instanceof t?new t(e):t(e)};return e[r]=t[r],e}(c):f&&"function"==typeof c?o(Function.call,c):c,f&&((y[r]||(y[r]={}))[l]=c))};a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,t.exports=a},function(t,e){var s=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=s)},function(t,e){var s=t.exports={version:"1.2.6"};"number"==typeof __e&&(__e=s)},function(t,e,s){var n=s(13);t.exports=function(t,e,s){if(n(t),void 0===e)return t;switch(s){case 1:return function(s){return t.call(e,s)};case 2:return function(s,n){return t.call(e,s,n)};case 3:return function(s,n,i){return t.call(e,s,n,i)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){t.exports=function(t){try{return!!t()}catch(e){return!0}}},function(t,e,s){var n=s(16),i=s(6).getNames,o={}.toString,r="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(t){try{return i(t)}catch(e){return r.slice()}};t.exports.get=function(t){return r&&"[object Window]"==o.call(t)?a(t):i(n(t))}},function(t,e,s){var n=s(17),i=s(19);t.exports=function(t){return n(i(t))}},function(t,e,s){var n=s(18);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){var s={}.toString;t.exports=function(t){return s.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,s){t.exports={"default":s(21),__esModule:!0}},function(t,e,s){s(22),t.exports=s(11).Object.assign},function(t,e,s){var n=s(9);n(n.S+n.F,"Object",{assign:s(23)})},function(t,e,s){var n=s(6),i=s(24),o=s(17);t.exports=s(14)(function(){var t=Object.assign,e={},s={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(t){s[t]=t}),7!=t({},e)[n]||Object.keys(t({},s)).join("")!=i})?function(t,e){for(var s=i(t),r=arguments,a=r.length,l=1,u=n.getKeys,c=n.getSymbols,p=n.isEnum;a>l;)for(var h,d=o(r[l++]),f=c?u(d).concat(c(d)):u(d),g=f.length,v=0;g>v;)p.call(d,h=f[v++])&&(s[h]=d[h]);return s}:Object.assign},function(t,e,s){var n=s(19);t.exports=function(t){return Object(n(t))}},function(t,e,s){t.exports={"default":s(26),__esModule:!0}},function(t,e,s){var n=s(6);t.exports=function(t,e){return n.create(t,e)}},function(t,e,s){var n=s(28);"string"==typeof n&&(n=[[t.id,n,""]]);s(30)(n,{});n.locals&&(t.exports=n.locals)},function(t,e,s){e=t.exports=s(29)(),e.push([t.id,".item-form{position:relative}.item-form,.item-form input[type=text]{font-size:1rem}.item-form input[type=text]:focus+.autocomplete-hints{border-color:#33a3fe;border-top-color:#b9b9b9}.item-state-search .btn-icon:before{content:'\\26B2';transform:rotate(-45deg);display:inline-block}.item-state-add .btn-icon:before{content:'+'}.item-state-filled .btn-icon:before{content:'\\D7'}.item-state-select .btn-icon:hover{opacity:.2;cursor:default}.item-state-select .btn-icon:before{content:'\\21D9'}.item-state-loading .btn-icon:before{content:'\\21BB'}.btn-icon{position:absolute;top:0;right:0;width:30px;font-size:24px}.btn-icon,.btn-icon:before{height:100%;line-height:100%}.btn-icon:before{vertical-align:text-top}.autocomplete-hints{z-index:10000;top:100%;background:#fff;border:1px solid #b9b9b9;border-bottom-left-radius:2px;border-bottom-right-radius:2px;margin-top:-1px;max-width:100%;width:100%;max-height:200px;overflow-y:scroll}.autocomplete-hints>.autocomplete-hint{padding:5px 10px;cursor:pointer}.autocomplete-hints>.autocomplete-hint.autocomplete-selected,.autocomplete-hints>.autocomplete-hint:hover{background:#e5e5e5}.autocomplete-hints strong{color:#33a3fe;font-weight:400}",""])},function(t,e){t.exports=function(){var t=[];return t.toString=function(){for(var t=[],e=0;e<this.length;e++){var s=this[e];s[2]?t.push("@media "+s[2]+"{"+s[1]+"}"):t.push(s[1])}return t.join("")},t.i=function(e,s){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},i=0;i<this.length;i++){var o=this[i][0];"number"==typeof o&&(n[o]=!0)}for(i=0;i<e.length;i++){var r=e[i];"number"==typeof r[0]&&n[r[0]]||(s&&!r[2]?r[2]=s:s&&(r[2]="("+r[2]+") and ("+s+")"),t.push(r))}},t}},function(t,e,s){function n(t,e){for(var s=0;s<t.length;s++){var n=t[s],i=d[n.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](n.parts[o]);for(;o<n.parts.length;o++)i.parts.push(u(n.parts[o],e))}else{for(var r=[],o=0;o<n.parts.length;o++)r.push(u(n.parts[o],e));d[n.id]={id:n.id,refs:1,parts:r}}}}function i(t){for(var e=[],s={},n=0;n<t.length;n++){var i=t[n],o=i[0],r=i[1],a=i[2],l=i[3],u={css:r,media:a,sourceMap:l};s[o]?s[o].parts.push(u):e.push(s[o]={id:o,parts:[u]})}return e}function o(t,e){var s=v(),n=b[b.length-1];if("top"===t.insertAt)n?n.nextSibling?s.insertBefore(e,n.nextSibling):s.appendChild(e):s.insertBefore(e,s.firstChild),b.push(e);else{if("bottom"!==t.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");s.appendChild(e)}}function r(t){t.parentNode.removeChild(t);var e=b.indexOf(t);e>=0&&b.splice(e,1)}function a(t){var e=document.createElement("style");return e.type="text/css",o(t,e),e}function l(t){var e=document.createElement("link");return e.rel="stylesheet",o(t,e),e}function u(t,e){var s,n,i;if(e.singleton){var o=m++;s=y||(y=a(e)),n=c.bind(null,s,o,!1),i=c.bind(null,s,o,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(s=l(e),n=h.bind(null,s),i=function(){r(s),s.href&&URL.revokeObjectURL(s.href)}):(s=a(e),n=p.bind(null,s),i=function(){r(s)});return n(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;n(t=e)}else i()}}function c(t,e,s,n){var i=s?"":n.css;if(t.styleSheet)t.styleSheet.cssText=x(e,i);else{var o=document.createTextNode(i),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}function p(t,e){var s=e.css,n=e.media;e.sourceMap;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=s;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(s))}}function h(t,e){var s=e.css,n=(e.media,e.sourceMap);n&&(s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var i=new Blob([s],{type:"text/css"}),o=t.href;t.href=URL.createObjectURL(i),o&&URL.revokeObjectURL(o)}var d={},f=function(t){var e;return function(){return"undefined"==typeof e&&(e=t.apply(this,arguments)),e}},g=f(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),v=f(function(){return document.head||document.getElementsByTagName("head")[0]}),y=null,m=0,b=[];t.exports=function(t,e){e=e||{},"undefined"==typeof e.singleton&&(e.singleton=g()),"undefined"==typeof e.insertAt&&(e.insertAt="bottom");var s=i(t);return n(s,e),function(t){for(var o=[],r=0;r<s.length;r++){var a=s[r],l=d[a.id];l.refs--,o.push(l)}if(t){var u=i(t);n(u,e)}for(var r=0;r<o.length;r++){var l=o[r];if(0===l.refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete d[l.id]}}}};var x=function(){var t=[];return function(e,s){return t[e]=s,t.filter(Boolean).join("\n")}}()}])});
//# sourceMappingURL=sf.autocomplete.min.js.map